2025-01-10 (FRIDAY): CVE-2017-0199 XLS --> HTA --> VBS --> STEGANOGRAPHY --> DBAT- OR GU-STYLE LOADER FOR AGENTTESLA

AUTHORS:

- Vishwa Thothathri, Bradley Duncan

INFECTION CHAIN:

- presumably through email --> CVE-2017-0199 Excel file --> HTA --> VBS --> JPG with embedded info --> DBatLoader/GuLoader style malware --> AgentTelsa-style FTP data exfiltration

NOTES:

- Criminals have been creating malicious Microsoft Office documents to exploit CVE-2017-0199 for years.
- Exploits for CVE-2017-0199 generally affect very outdated systems, but we still see new samples near-daily.
- This particular campaign has been active since 2023 or earlier and most often distributes a DBatLoader/GuLoader style malware.
- This loader is a .NET DLL delivered using steganography, embedded in an image as reversed base64 text.
- In recent months, we've seen the DBatLoader/GuLoader style malware for either AgentTelsa-style malware, Formbook (XLoader), LokiBot or Remcos RAT from this campaign.
- A good writeup on this activity was published in August 2023 at:
  -- https://cyble.com/blog/threat-actor-employs-powershell-backed-steganography-in-recent-spam-campaigns/

RECENT EXAMPLES OF CVE-2017-0199 EXCEL FILES:

(READ: SHA256 hash - date first seen - file name)

- 2b14225a0e97081a7142e16423136b06c17cea24ed34b9e696864823468d7dfc - 2025-01-09 - Nuevo orden.xla
- 519cda9511738dfa6ad57a5716bd217d9c44af7023907711ddc76c4511f24d60 - 2025-01-07 - PO#3311-20250108003.xls
- 6071e54c8bad5762b8e10753fac7ea636970e2ab7fbe7f4c56b9f1b38fdcdbb4 - 2024-12-20 - SWIFT.xls
- 4b668425ec80d4ac34429924e11f7936deaf11289c24107dcf1e9c04c259f775 - 2024-12-20 - MS100384UTC.xls
- 379fe2ae5a34b2349fe492b4318c589416c5cc8f1e54eb1502455863da17395e - 2024-12-18 - Order_948575494759.xls

INITIAL CVE-2017-0199 EXCEL FILE USED FOR AN INFECTION CHAIN ON 2025-01-09:

- SHA256 hash: 2b14225a0e97081a7142e16423136b06c17cea24ed34b9e696864823468d7dfc
- File size: 1,091,584 bytes
- File type: Composite Document File V2 Document, Name of Creating Application: Microsoft Excel
- File name: Nuevo orden.xla
- File description: Malicious Excel file with exploit for CVE-2017-0199
- First noted in the wild: Thursday 2025-01-09

INITIAL INFECTION TRAFFIC FROM THE ABOVE EXCEL FILE:

- hxxps[:]//s.deemos[.]com/6ruXkfgh?&sherry=strange&octagon=fragile&initiative=rough&corsage
- hxxp[:]//192.3.27[.]144/xampp/mpa/seemebestthingsevermeetgivenbestthingsfornewways.hta
- hxxp[:]//107.172.31[.]5/comonstraints.vbs
- hxxps[:]//res.cloudinary[.]com/dnkr4s5yg/image/upload/v1735420882/givvuo2katk3jnggipgn.jpg
- hxxp[:]//107.172.31[.]5/foeMMBIG.txt

ASSOCIATED FILES FOR THE INFECTION:

- SHA256 hash: df215a01f6a83014a148c6e407cdc8422e9119a88b4220a1321b2986ea9aef63
- File size: 47,975 bytes
- File type: HTML document text, ASCII text, with very long lines, with CRLF line terminators
- File location: hxxp[:]//192.3.27[.]144/xampp/mpa/seemebestthingsevermeetgivenbestthingsfornewways.hta
- File description: HTA file retrieved and run by the initial malicious Excel file

- SHA256 hash: a666a99f2056082802f459f7180f891582a527324a16d34b4755ed63e5467882
- File size: 223,012 bytes
- File type: UTF-8 Unicode text, with very long lines, with CRLF line terminators
- File location: hxxp[:]//107.172.31[.]5/comonstraints.vbs
- File description: Visual Basic script retrieved and run by the above HTA file

- SHA256 hash: 31f30a8b7270e00247b64c28cab661f23660c398d0da80b953e6587d58e4a429
- File size: 2,469,849 bytes
- File type: JPEG image data
- File location: hxxps[:]//res.cloudinary[.]com/dnkr4s5yg/image/upload/v1735420882/givvuo2katk3jnggipgn.jpg
- File description: Retrieved by the above VBS file, a JPEG image with embedded block of reversed base64 text

- SHA256 hash: fb5116f93365182f235b12d780e03bb8a2a98f389f81cf0d5832dbdc722b346d
- File size: 1,564,160 bytes
- File type: PE32 executable (DLL) (console) Intel 80386 Mono/.Net assembly, for MS Windows
- File description: .NET DLL for DBatLoader/GuLoader style malware from the reversed Base64-encoded text embedded in the above JPEG image.

- SHA256 hash: 018648727f760e361eb4efa7f955a7815a197224c23016b321ab954767b45b82
- File size: 325,632 bytes
- File type: ASCII text, with very long lines, with no line terminators
- File location: http[:]//107.172.31[.]5/foeMMBIG.txt
- File description: Base64-encoded text retrieved by the above loader for Agent Tesla variant

POST-INFECTION TRAFFIC FOR AGENTTESLA VARIANT ACTIVITY:

- hxxp[:]//ip-api[.]com/line/?fields=hosting - IP address check
- 89.39.83[.]184 - ftp.horeca-bucuresti[.]ro - unencrypted FTP traffic for data exfiltration
