2025-01-06: CHANGES TO HEARTCRYPT-PACKED MALWARE

AUTHOR:

- Jerome Tujague

NOTES:

- HeartCrypt is a packer-as-a-service (PaaS) for Windows-based malware that first appeared in February 2024.
- This packer hides malware inside copies of legitimate packed executable (PE) files to evade detection.
- We recently published an article about HeartCrypt in December 2024 at:
  -- https://unit42.paloaltonetworks.com/packer-as-a-service-heartcrypt-malware/
- Since that article, we've noticed some changes to how these files are now packed.

- Recent HeartCrypt-packed samples have moved the position-independent code (PIC) used to generate the malware payload:
  -- The PIC has been removed from the PE file's resource data
  -- The payload is now stored as XOR-encrypted blocks of data in two different files that pretend to be bitmap (BMP) images.
  -- These two files have a fake BMP header followed by junk data, followed by an XOR key, followed by the XOR-encrypted data.
  -- Decrypted code from these two XOR-encrypted blocks of data are combined into the final payload.

- We've updated our extraction process to extract the malware payload from these HeartCrypt-packed samples.
- Some examples follow.

SHA256 HASHES FROM NEWER HEARTCRYPT-PACKED SAMPLES AND THEIR EXTRACTED MALWARE:

- HeartCrypt-packed sample: 1b7411d5d2854c40f66cc933f80f147167e39778f54115b842fc32b4a5d3d483
- Extracted malware: 04809b6c2ded264239046b2e163efc1eadfc3134269a9875febe433fc87d7cd7

- HeartCrypt-packed sample: 87c1cb9d609659ce466d16354973ce4dbb8bea8652dbe104a196e42b3a739786
- Extracted malware: f5d64f16f06ef3267bb04f756aca89e3fbfbc82f57a49e07e0778ee5bba695fa

- HeartCrypt-packed sample: 2baf9b0ff18b826f394498385d0ac66b241cd55c9e35822f50c97ec33ed8df8e
- Extracted malware: 3d25c3d1cc2a4fc15f7067e94d9db191c5a4f48729dfa93556a7b0a563486628
